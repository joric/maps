<meta name="viewport" content="initial-scale=1.0, user-scalable=no">

<template id="remote">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/js/all.min.js"></script>
</template>

<template id="local">
  <script src="../../lib/font-awesome/js/all.min.js"></script>
</template>

<script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css">

<link rel="stylesheet" href="search-control/search-control.css" />
<script src="search-control/search-control.js"></script>

<link rel="stylesheet" href="markers-control/markers-control.css" />
<script src="markers-control/markers-control.js"></script>

<style>
html, body, #map { width:100%; height: 100%; margin: 0; padding: 0; }
body { 
/*
  background:
    repeating-radial-gradient(circle at 20% 30%, #fffb 0 25px, #0000 25px 50px),
    repeating-radial-gradient(circle at 80% 70%, #0ff8 0 20px, #0000 20px 50px),
    repeating-linear-gradient(45deg, #f0f5 0 25px, #0000 25px 50px),
    repeating-linear-gradient(-45deg, #0f08 0 25px, #0000 25px 50px),
    linear-gradient(135deg, #f06, #fc0, #0cf, #90f);
    */
}

.controls-topleft {
  position: absolute;
  top: 0;
  left: 0;
  display: flex;
  align-items: flex-start;
  padding: 16px;
  z-index: 1000;
}

#themeCtrl {
  position: absolute;
  top: 80px;
  left: 16px;
  z-index: 1000;
}

</style>

<div id="map"></div>

<body>
<select id="themeCtrl" name=theme onchange="location.hash=this.value;window.onload()">
<option value="">Select Theme</option>
<option value="">default</option>
<option value="glass">glass</option>
<option value="retro">retro</option>
</select>

<div class="controls-topleft"/>
</body>

<script>
document.head.appendChild(document.getElementById(location.protocol === 'file:' ? 'local' : 'remote').content.cloneNode(true));

let map = null;

window.onload = function(event) {

  if (map) map.remove();

  map = L.map('map',{zoomControl: false}).setView([51.505, -0.09], 13);

  /*
  const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  }).addTo(map);
  */

  baseLayers = {};

  baseLayers['Esri World Imagery'] = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
  }).addTo(map);

  baseLayers['CartoDB Voyager'] = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
    subdomains: 'abcd',
    maxZoom: 20
  });

  baseLayers['Esri World Street Map'] = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012'
  });

  baseLayers['OpenStreetMap Mapnik'] = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  });

  baseLayers['OSM Humanitarian'] = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Tiles style by <a href="https://www.hotosm.org/" target="_blank">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr/" target="_blank">OpenStreetMap France</a>'
  });




  L.control.layers(baseLayers, {}, {
    collapsed: false,
  }).addTo(map);


  let theme = location.hash ? location.hash.slice(1) : '';

  let searchControl = new SearchControl(null, {theme: theme});

  searchControl._handleSubmit = function() {
    console.log('here', searchControl._input.value);
  }

  let counters =  {
    'collectibles': { 'house': 1, 'file': 2 },
    'locations': { 'image': 3 },
    'NPCs': { 'user': 3 },
    'quests': {'part': 50},
  };

  let icons = {
    'house': {'class': 'fa fa-house'},
    'file': {'class': 'fa fa-file'},
    'image': {'class': 'fa fa-image'},
    'user': {'class': 'fa fa-user'},
    'part': {'class': 'fa fa-gear'},
  }

  for (let i=0; i<100; i++) {
    counters['quests'][`quest_longname_longname_longname_${i}`] = i*5000;
  }

  let markersControl = new MarkersControl(counters, {icons: icons, groupCallback:()=>{}, itemCallback:()=>{}, theme:theme});
}

</script>
